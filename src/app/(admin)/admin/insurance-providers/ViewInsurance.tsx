"use client"

import React, { useEffect, useRef, useState } from "react";


type PolicyViewProps = {
    viewModal: boolean;
    setViewModal: React.Dispatch<React.SetStateAction<boolean>>;
};

const UploadBlog: React.FC<PolicyViewProps> = ({
    viewModal,
    setViewModal,
}) => {
    const modalRef = useRef<HTMLDivElement>(null);
    const firstFocusableRef = useRef<HTMLButtonElement>(null);
    const [showModal, setShowModal] = useState(false);

    // Open animation
    useEffect(() => {
        if (viewModal) {
            const timer = setTimeout(() => setShowModal(true), 50);
            return () => clearTimeout(timer);
        }
    }, [viewModal]);

    // Close modal
    const handleClose = React.useCallback(() => {
        setShowModal(false);
        setTimeout(() => setViewModal(false), 500);
    }, [setViewModal]);

    // Close on click outside
    useEffect(() => {
        const handleClickOutside = (e: MouseEvent) => {
            if (modalRef.current && !modalRef.current.contains(e.target as Node)) {
                handleClose();
            }
        };
        document.addEventListener("mousedown", handleClickOutside);
        return () => document.removeEventListener("mousedown", handleClickOutside);
    }, [handleClose]);

    // Close on ESC and handle focus trap
    useEffect(() => {
        const handleKeyDown = (e: KeyboardEvent) => {
            if (e.key === "Escape") handleClose();

            if (e.key === "Tab" && modalRef.current) {
                const focusableEls = modalRef.current.querySelectorAll(
                    'a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])'
                );
                const firstEl = focusableEls[0] as HTMLElement;
                const lastEl = focusableEls[focusableEls.length - 1] as HTMLElement;

                if (!e.shiftKey && document.activeElement === lastEl) {
                    firstEl.focus();
                    e.preventDefault();
                } else if (e.shiftKey && document.activeElement === firstEl) {
                    lastEl.focus();
                    e.preventDefault();
                }
            }
        };

        if (viewModal) {
            document.addEventListener("keydown", handleKeyDown);
            // Focus first button
            setTimeout(() => firstFocusableRef.current?.focus(), 100);
        }
        return () => document.removeEventListener("keydown", handleKeyDown);
    }, [viewModal, handleClose]);











    return (
        <>
            {/* Backdrop */}
            <div
                className={`fixed inset-0 z-50   bg-opacity-50 transition-opacity duration-500 ${showModal ? "opacity-100" : "opacity-0 pointer-events-none"
                    }`}
                onClick={handleClose}
            />

            {/* Modal */}
            <div
                ref={modalRef}
                role="dialog"
                aria-modal="true"
                className={`fixed z-50 top-0 h-[95vh] overflow-y-auto left-1/2 transform -translate-x-1/2 max-w-3xl w-full mx-4 bg-white shadow-lg rounded-lg pt-12 pb-6 px-12 transition-all duration-500 ease-out
          ${showModal ? "translate-y-20 opacity-100 scale-100" : "-translate-y-40 opacity-0 scale-95"}`}
            >
                {/* Close Button */}
                <button
                    onClick={handleClose}
                    ref={firstFocusableRef}
                    className="absolute top-4 right-4 cursor-pointer text-gray-500 hover:text-gray-700 text-2xl font-bold"
                >
                    ✕
                </button>


                <div>


                    {/* Header: Logo and Insurance Title */}
                    <div className="flex  mb-6 gap-x-7 ">
                        {/* <Image
                            width={100}
                            height={100}
                            src="https://via.placeholder.com/50"
                            alt="insurance logo"
                            className="w-12 h-12 mr-4 rounded-full"
                        /> */}
                        <svg width="109" height="113" viewBox="0 0 109 113" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="0.795775" y="0.795775" width="106.634" height="111.408" rx="8.75352" fill="#FAF5EC" />
                            <rect x="0.795775" y="0.795775" width="106.634" height="111.408" rx="8.75352" stroke="#E9D1A7" strokeWidth="1.59155" />
                            <path d="M82.2533 61.357C82.2533 64.2736 81.8026 67.0802 80.9768 69.7203H51.6372L76.7081 44.6494C80.1929 49.3083 82.2533 55.0922 82.2533 61.357Z" fill="#F79F1E" />
                            <path d="M35.2796 68.6067C35.2878 67.9546 35.0833 67.6528 34.4638 67.291C33.8859 66.9533 33.3066 66.0927 33.2753 65.4363C33.1451 62.705 33.1887 59.9633 33.2364 57.2266C33.2602 55.8591 34.0188 55.1799 35.4241 55.1617C37.4453 55.1356 39.468 55.1236 41.4881 55.1777C42.0128 55.1918 42.5304 55.4738 43.0513 55.6328C43.0493 55.7642 43.0471 55.8956 43.045 56.0271C40.7274 56.833 40.0756 58.5497 40.1573 60.8097C40.2532 63.4595 40.1154 66.1179 40.2175 68.7673C40.2293 69.0734 40.2692 69.3986 40.3364 69.7203H41.7593C41.6825 69.374 41.6561 68.9511 41.6556 68.4083C41.6523 65.6311 41.6444 62.8539 41.6557 60.0767C41.6631 58.2294 42.428 57.4541 44.2485 57.4429C46.4365 57.4294 48.6248 57.4246 50.8128 57.4425C52.5682 57.4567 53.3359 58.2314 53.3465 60.0096C53.3623 62.6737 53.3416 65.3381 53.3556 68.0022L54.8232 66.5346C54.823 64.6178 54.7791 62.6996 54.848 60.7854C54.9295 58.5217 54.2516 56.8197 51.572 55.8879C52.3759 55.5034 52.843 55.0976 53.3231 55.0817C55.4673 55.0105 57.6155 55.022 59.7612 55.0615C61.0327 55.0848 61.7183 55.7481 61.7397 57.0308C61.7539 57.8806 61.7674 58.7309 61.7766 59.5812L76.7083 44.6494C71.6138 37.8315 63.4816 33.4226 54.3192 33.4226C43.3904 33.4226 33.9333 39.7028 29.3438 48.8476C27.4545 52.6119 26.3848 56.8584 26.3848 61.357C26.3848 64.2736 26.8354 67.0802 27.6649 69.7203H35.2746C35.2766 69.3491 35.275 68.9778 35.2796 68.6067ZM56.614 46.6622C58.6943 46.6812 60.3635 48.3688 60.3592 50.4485C60.355 52.5215 58.6807 54.2282 56.6191 54.2613C54.487 54.2954 52.7688 52.5959 52.7688 50.4528C52.7688 48.284 54.4342 46.6424 56.614 46.6622ZM47.6501 48.0422C49.9941 48.1052 51.8276 50.0574 51.7697 52.4281C51.7111 54.8284 49.6985 56.6936 47.2874 56.5824C44.9295 56.4736 43.1554 54.5234 43.2385 52.1316C43.3202 49.782 45.2662 47.9781 47.6501 48.0422ZM38.5071 46.7909C40.5989 46.8159 42.2381 48.4804 42.2362 50.5773C42.2341 52.7516 40.5754 54.387 38.3928 54.3667C36.2993 54.3472 34.6559 52.6882 34.6508 50.5892C34.6455 48.4563 36.3626 46.7652 38.5071 46.7909Z" fill="#EB001B" />
                            <path d="M25.4648 72.2693V70.668H27.0782V72.2693H25.4648ZM25.4648 79.4572V73.1482H27.0782V79.4572H25.4648Z" fill="#414042" />
                            <path d="M34.6995 79.4567H33.0861V75.9169C33.0861 75.4112 32.9976 75.0421 32.8212 74.8092C32.6445 74.5765 32.3998 74.46 32.0867 74.46C31.9261 74.46 31.7617 74.4922 31.5931 74.5564C31.4245 74.6207 31.2659 74.711 31.1175 74.8273C30.9689 74.9438 30.8345 75.0822 30.7142 75.2427C30.5938 75.4033 30.5054 75.5798 30.4493 75.7724V79.4567H28.8359V73.1477H30.2928V74.3156C30.5254 73.9143 30.8626 73.6013 31.3041 73.3764C31.7454 73.1518 32.2433 73.0393 32.7971 73.0393C33.1902 73.0393 33.5114 73.1116 33.7603 73.256C34.009 73.4005 34.2016 73.5892 34.3383 73.8219C34.4746 74.0548 34.5689 74.3197 34.6212 74.6166C34.6733 74.9137 34.6995 75.2146 34.6995 75.5195V79.4567Z" fill="#414042" />
                            <path d="M38.7928 79.5775C38.263 79.5775 37.7453 79.4932 37.2396 79.3246C36.7339 79.156 36.3004 78.9152 35.9392 78.6022L36.5412 77.5907C36.9265 77.8638 37.3016 78.0705 37.667 78.2108C38.0321 78.3514 38.3954 78.4215 38.7566 78.4215C39.0775 78.4215 39.3304 78.3614 39.5151 78.2409C39.6997 78.1205 39.7921 77.948 39.7921 77.7232C39.7921 77.4986 39.6837 77.3339 39.467 77.2295C39.2503 77.1253 38.897 77.0049 38.4075 76.8683C37.9981 76.756 37.649 76.6476 37.36 76.5432C37.0711 76.4391 36.8382 76.3205 36.6617 76.1881C36.4851 76.0556 36.3566 75.9033 36.2764 75.7306C36.1961 75.5581 36.1561 75.3513 36.1561 75.1105C36.1561 74.7895 36.2181 74.5006 36.3426 74.2436C36.4669 73.9868 36.6416 73.7681 36.8664 73.5875C37.091 73.4069 37.354 73.2684 37.6549 73.1721C37.956 73.0758 38.2829 73.0276 38.6362 73.0276C39.1098 73.0276 39.5532 73.0958 39.9667 73.2323C40.38 73.3689 40.7592 73.5896 41.1045 73.8945L40.4543 74.8697C40.1332 74.6289 39.8222 74.4525 39.5212 74.34C39.2201 74.2277 38.921 74.1714 38.6241 74.1714C38.3511 74.1714 38.1224 74.2277 37.9379 74.34C37.7532 74.4525 37.661 74.6331 37.661 74.8818C37.661 74.9943 37.683 75.0865 37.7272 75.1587C37.7712 75.2309 37.8416 75.2953 37.9379 75.3513C38.0343 75.4075 38.1607 75.4617 38.3172 75.5139C38.4737 75.5661 38.6683 75.6204 38.9012 75.6764C39.3347 75.789 39.7058 75.9013 40.0149 76.0136C40.3239 76.126 40.5767 76.2544 40.7734 76.3988C40.97 76.5433 41.1145 76.71 41.2069 76.8985C41.2991 77.0872 41.3453 77.3139 41.3453 77.5787C41.3453 78.1969 41.1166 78.6846 40.6591 79.0416C40.2015 79.399 39.5793 79.5775 38.7928 79.5775Z" fill="#414042" />
                            <path d="M44.6204 79.5776C43.9702 79.5776 43.4766 79.3689 43.1395 78.9515C42.8023 78.5342 42.6338 77.9161 42.6338 77.0973V73.1482H44.2471V76.7482C44.2471 77.7195 44.5964 78.2051 45.2946 78.2051C45.6077 78.2051 45.9106 78.1108 46.2037 77.9221C46.4966 77.7336 46.7353 77.4466 46.92 77.0612V73.1482H48.5333V77.6031C48.5333 77.7716 48.5635 77.892 48.6237 77.9642C48.6839 78.0365 48.782 78.0768 48.9187 78.0847V79.4572C48.758 79.4892 48.6237 79.5093 48.5153 79.5174C48.407 79.5253 48.3085 79.5294 48.2203 79.5294C47.9313 79.5294 47.6966 79.4632 47.516 79.3307C47.3354 79.1983 47.2289 79.0158 47.197 78.7829L47.1609 78.2773C46.8798 78.7108 46.5186 79.0358 46.0773 79.2525C45.6357 79.4692 45.1501 79.5776 44.6204 79.5776Z" fill="#414042" />
                            <path d="M54.1918 74.5445C53.7022 74.5527 53.2647 74.6469 52.8795 74.8275C52.4941 75.0081 52.2173 75.279 52.0487 75.6401V79.4568H50.4353V73.1478H51.9162V74.4963C52.0285 74.2796 52.161 74.085 52.3135 73.9123C52.466 73.7398 52.6305 73.5893 52.8072 73.4608C52.9836 73.3325 53.1624 73.2341 53.343 73.1658C53.5236 73.0977 53.6982 73.0635 53.8667 73.0635C53.955 73.0635 54.0211 73.0635 54.0654 73.0635C54.1094 73.0635 54.1515 73.0676 54.1918 73.0755L54.1918 74.5445Z" fill="#414042" />
                            <path d="M57.0338 79.5771C56.7287 79.5771 56.444 79.5269 56.179 79.4266C55.9141 79.3264 55.6854 79.1858 55.4928 79.0052C55.3001 78.8246 55.1496 78.6139 55.0412 78.3731C54.9329 78.1323 54.8787 77.8674 54.8787 77.5785C54.8787 77.2816 54.945 77.0066 55.0773 76.7537C55.2097 76.5008 55.3942 76.2861 55.6312 76.1096C55.8678 75.9331 56.1508 75.7946 56.4801 75.6942C56.8091 75.5939 57.1703 75.5437 57.5637 75.5437C57.8445 75.5437 58.1193 75.5678 58.3884 75.616C58.6572 75.6641 58.896 75.7324 59.1048 75.8207V75.4594C59.1048 75.0421 58.9862 74.721 58.7495 74.4962C58.5127 74.2716 58.1614 74.1591 57.696 74.1591C57.3588 74.1591 57.0297 74.2192 56.7087 74.3397C56.3875 74.4601 56.0585 74.6367 55.7215 74.8694L55.2278 73.846C56.0385 73.3084 56.9135 73.0393 57.8526 73.0393C58.7596 73.0393 59.4639 73.262 59.9655 73.7075C60.4671 74.153 60.7181 74.7972 60.7181 75.64V77.6025C60.7181 77.7711 60.7482 77.8914 60.8084 77.9637C60.8686 78.036 60.9669 78.0762 61.1034 78.0841V79.4567C60.8304 79.5128 60.5936 79.541 60.393 79.541C60.0878 79.541 59.8531 79.4726 59.6887 79.3363C59.5241 79.1999 59.4217 79.0193 59.3817 78.7944L59.3456 78.4453C59.0645 78.8145 58.7235 79.0955 58.3221 79.2881C57.9207 79.4808 57.4915 79.5771 57.0338 79.5771ZM57.4915 78.3972C57.7641 78.3972 58.0231 78.349 58.2679 78.2527C58.5127 78.1563 58.7033 78.028 58.8399 77.8673C59.0164 77.731 59.1048 77.5784 59.1048 77.4099V76.6874C58.9121 76.6151 58.7033 76.5571 58.4787 76.5128C58.254 76.4688 58.0373 76.4466 57.8286 76.4466C57.4111 76.4466 57.07 76.541 56.8052 76.7295C56.5403 76.9182 56.4079 77.157 56.4079 77.4459C56.4079 77.7189 56.512 77.9456 56.7209 78.1262C56.9294 78.3069 57.1862 78.3972 57.4915 78.3972Z" fill="#414042" />
                            <path d="M68.3875 79.4567H66.7741V75.9169C66.7741 75.4112 66.6857 75.0421 66.5092 74.8092C66.3327 74.5765 66.0878 74.46 65.7748 74.46C65.6142 74.46 65.4497 74.4922 65.2811 74.5564C65.1125 74.6207 64.9539 74.711 64.8055 74.8273C64.657 74.9438 64.5227 75.0822 64.4022 75.2427C64.2818 75.4033 64.1934 75.5798 64.1373 75.7724V79.4567H62.5239V73.1477H63.9808V74.3156C64.2134 73.9143 64.5506 73.6013 64.9922 73.3764C65.4335 73.1518 65.9312 73.0393 66.4851 73.0393C66.8783 73.0393 67.1995 73.1116 67.4482 73.256C67.697 73.4005 67.8897 73.5892 68.0262 73.8219C68.1626 74.0548 68.2569 74.3197 68.3092 74.6166C68.3613 74.9137 68.3874 75.2146 68.3874 75.5195L68.3875 79.4567Z" fill="#414042" />
                            <path d="M69.6997 76.3027C69.6997 75.8613 69.7761 75.4438 69.9285 75.0505C70.0808 74.6573 70.3018 74.3121 70.5908 74.015C70.8797 73.7182 71.2289 73.4813 71.6383 73.3047C72.0475 73.1282 72.5091 73.0398 73.0228 73.0398C73.713 73.0398 74.301 73.1884 74.7867 73.4853C75.2723 73.7823 75.6355 74.1716 75.8762 74.6531L74.299 75.1348C74.1624 74.9021 73.9818 74.7235 73.7572 74.599C73.5323 74.4747 73.2836 74.4124 73.0107 74.4124C72.7779 74.4124 72.5612 74.4587 72.3606 74.5509C72.1597 74.6433 71.9852 74.7717 71.8369 74.9362C71.6882 75.1009 71.5719 75.2995 71.4876 75.5322C71.4034 75.7651 71.3612 76.0219 71.3612 76.3028C71.3612 76.5839 71.4053 76.8406 71.4937 77.0734C71.5818 77.3063 71.7002 77.5068 71.8488 77.6754C71.9972 77.8439 72.1718 77.9745 72.3726 78.0666C72.5731 78.159 72.7859 78.2051 73.0108 78.2051C73.2998 78.2051 73.5665 78.1329 73.8114 77.9884C74.0561 77.8439 74.2268 77.6675 74.3231 77.4587L75.9004 77.9402C75.6837 78.4218 75.3264 78.8152 74.8287 79.1202C74.331 79.4253 73.7332 79.5778 73.0348 79.5778C72.5209 79.5778 72.0595 79.4893 71.6501 79.3129C71.2409 79.1364 70.8916 78.8975 70.6026 78.5965C70.3137 78.2955 70.091 77.9463 69.9344 77.549C69.7781 77.1514 69.6997 76.7361 69.6997 76.3027Z" fill="#414042" />
                            <path d="M80.0542 79.5771C79.5486 79.5771 79.0911 79.4908 78.6817 79.3182C78.2723 79.1457 77.9231 78.911 77.6342 78.6139C77.3452 78.317 77.1226 77.9718 76.966 77.5785C76.8094 77.1853 76.7312 76.7718 76.7312 76.3383C76.7312 75.8889 76.8074 75.4654 76.96 75.0681C77.1123 74.6708 77.3331 74.3216 77.6221 74.0206C77.9111 73.7196 78.2621 73.4808 78.6757 73.3042C79.0889 73.1277 79.5525 73.0393 80.0662 73.0393C80.5799 73.0393 81.0394 73.1277 81.4449 73.3042C81.8501 73.4808 82.1953 73.7177 82.4803 74.0146C82.7651 74.3116 82.9819 74.6568 83.1305 75.05C83.2789 75.4434 83.3531 75.8527 83.3531 76.2781C83.3531 76.3825 83.3511 76.4828 83.3472 76.5791C83.3431 76.6754 83.3331 76.7558 83.317 76.8199H78.4409C78.4649 77.0688 78.5251 77.2895 78.6215 77.4821C78.7178 77.6747 78.8422 77.8394 78.9947 77.9758C79.147 78.1124 79.3197 78.2166 79.5124 78.2888C79.7051 78.3611 79.9055 78.3972 80.1144 78.3972C80.4354 78.3972 80.7384 78.319 81.0234 78.1624C81.3082 78.0058 81.503 77.7993 81.6074 77.5423L82.9919 77.9276C82.759 78.4092 82.3879 78.8046 81.8783 79.1136C81.3684 79.4227 80.7605 79.5771 80.0542 79.5771ZM81.6916 75.7724C81.6514 75.299 81.4768 74.9197 81.1679 74.6346C80.8588 74.3498 80.4835 74.2072 80.0422 74.2072C79.8255 74.2072 79.6227 74.2454 79.4343 74.3216C79.2455 74.3981 79.079 74.5043 78.9346 74.6407C78.79 74.7773 78.6716 74.9417 78.5793 75.1344C78.487 75.327 78.4328 75.5398 78.4167 75.7725L81.6916 75.7724Z" fill="#414042" />
                        </svg>

                        <div>
                            <h2 className=" lg:text-4xl text-lg text-black font-normal  ">Insurance</h2>
                            <div className="flex items-center space-x-1">
                                <span className=' font-bold text-[16px] ' >4.5</span>
                                <span className="text-yellow-500 text-lg ">★★★★☆</span>
                                <span className="text-sm text-gray-500">(1,450)</span>
                            </div>
                        </div>
                    </div>

                    {/* Overview Section */}
                    <div className=" px-8 pb-9 pt-4 bg-[#FAF5EC] shadow shadow-[#00000033] rounded-[10px] mb-6 ">
                        <h3 className=" lg:text-[27px] font-normal ">Overview</h3>
                        <div className="mt-2 grid grid-cols-2 ">
                            <div>
                                <div className=" text-lg text-[#000000] font-normal ">Category</div>
                                <div className="text-lg text-[#000000] font-thin ">Auto, Home</div>
                            </div>
                            <div>
                                <div className="text-lg text-[#000000] font-normal ">Price</div>
                                <div className="text-lg text-[#39CC6A] font-normal">$250</div>
                            </div>
                        </div>

                        {/* About Section */}
                        <div className=" mt-1 ">
                            <div className=" text-lg font-normal ">About</div>
                            <p className='text-lg font-thin' >
                                Progressive is a top contender for those who value convenience and
                                potential savings through its robust digital tools and
                                usage-based programs like Snapshot.
                            </p>
                        </div>

                        {/* Pros and Cons */}
                        <div className="grid grid-cols-2 gap-4 mt-4  ">
                            <div className="bg-green-100 pt-2.5 pb-8 rounded-lg px-6 ">
                                <div className=" font-normal text-[#188625] text-lg ">Pros</div>
                                <ul className=" text-xs mt-1.5   ">
                                    <li>Excellent claims handling process with quick resolution times</li>
                                    <li className=' mt-4 ' >User-friendly mobile app with full policy management capabilities</li>
                                </ul>
                            </div>
                            <div className="bg-[#FBE5DC]  rounded-lg px-4  pt-2.5 pb-8  ">
                                <div className="font-normal text-[#861818] text-lg ">Cons</div>
                                <ul className="text-xs mt-1.5 ">
                                    <li>Premium rates tend to be higher than some competitors</li>
                                    <li className=' mt-4 ' >Some policy documentation can be complex and difficult to understand</li>
                                </ul>
                            </div>
                        </div>
                    </div>


                    {/* Community Reviews Section */}
                    <div className=" bg-[#FAF5EC] shadow shadow-[#00000033] rounded-[10px] px-8 pt-4 pb-9  ">
                        <h3 className="lg:text-[27] text-lg text-black font-normal ">Community Reviews</h3>
                        <div className="flex items-center justify-between bg-[#E9D1A7] mt-4 rounded-[9px] py-2 px-4 ">
                            <div>
                                <div className=' flex justify-between ' >
                                    <div className=" font-normal text-[#000000] text-lg " >John D.</div>
                                    <div className="flex items-center gap-x-1  ">
                                        <span className=' font-normal text-[16px] ' >4.5</span>
                                        <span className="text-[#FEE453] text-xl ">★★★★☆</span>
                                    </div>
                                </div>
                                <p className=" mt-2 font-thin text-lg  ">
                                    Progressive is a top contender for those who value convenience and potential savings through its robust digital tools and usage-based programs like Snapshot.
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Action Buttons */}
                    <div className="flex justify-end space-x-4 mt-8 ">
                        <button className="flex items-center space-x-2 px-8 cursor-pointer py-3 bg-[#D93939] text-white   rounded-[36px] ">
                            <i className="fas fa-trash-alt"></i>
                            <span>Delete</span>
                        </button>
                        <button className="px-8 cursor-pointer py-3 bg-[#D09A40] text-white   rounded-[36px] ">
                            Save
                        </button>
                    </div>
                </div>




            </div>
        </>
    );
};

export default UploadBlog;
